-- Сеанс №1
BEGIN;
-- Начинаем первую транзакцию, автокоммит отключён

-- Сеанс №2
BEGIN;
-- Начинаем вторую транзакцию

-- Сеанс №1
SELECT rating FROM pizzeria WHERE name = 'Pizza Hut';
-- Смотрим текущий рейтинг

-- Сеанс №2
SELECT rating FROM pizzeria WHERE name = 'Pizza Hut';
-- Видим старый рейтинг 4.6

-- Сеанс №1
UPDATE pizzeria SET rating = 4 WHERE name = 'Pizza Hut';
-- Обновляем рейтинг до 4
-- Изменение локально видно в этом сеансе, но ещё не зафиксировано (нет COMMIT).

-- Сеанс №2
-- Пытаемся обновить рейтинг на 3.6
UPDATE pizzeria SET rating = 3.6 WHERE name = 'Pizza Hut';

-- Выполнение зависло, возвращаемся в сеанс №1
COMMIT;
-- Фиксируем первую транзакцию.

-- Это снимает блокировку и позволяет сеансу №2 продолжить UPDATE.
COMMIT;
-- Фиксируем изменения второго сеанса.

-- Итоговый запрос в любом из сеансов:
SELECT rating FROM pizzeria WHERE name = 'Pizza Hut';
-- Рейтинг будет 3.6.
-- Изменение рейтинга 4 из первой транзакции "потеряно" — это классический пример lost update.
